{% extends "base.html" %}

{% block title %}‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô{% endblock %}

{% block head_extra %}
<style>
  .profile-container {
    background: white;
    padding: 2.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    max-width: 700px;
    margin: 2rem auto;
  }

  .profile-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .profile-avatar {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #e5e7eb;
    margin-bottom: 1rem;
  }

  .avatar-placeholder {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3.5rem;
    color: #9ca3af;
    margin: 0 auto 1rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }

  .file-input-wrapper {
    position: relative;
    overflow: hidden;
  }

  .file-input-wrapper input[type="file"] {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
  }

  .preview-img {
    max-width: 180px;
    max-height: 180px;
    margin-top: 1rem;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    display: none;
  }

  .alert {
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
  }

  .alert-success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
  .alert-danger  { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
</style>
{% endblock %}

{% block content %}

<div class="profile-container">

  <div class="profile-header">
    <h1>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h1>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
  <div style="text-align: center; margin-bottom: 2rem;">
    {% if user.profile_picture %}
      <img src="{{ url_for('static', filename=user.profile_picture) }}" 
           alt="‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå" class="profile-avatar">
    {% else %}
      <div class="avatar-placeholder">üë§</div>
    {% endif %}
    <p style="color: #6b7280; font-size: 0.95rem;">
      ‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 200x200 ‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏• (‡πÑ‡∏ü‡∏•‡πå JPG/PNG ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB)
    </p>
  </div>

  <hr style="margin: 2rem 0; border-color: #e5e7eb;">

  <h3 style="margin-bottom: 1.5rem;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>

  <form method="POST" action="/profile" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
    <div class="form-group">
      <label class="form-label">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</label>
      <div class="file-input-wrapper">
        <button type="button" class="btn btn-secondary" style="padding: 0.7rem 1.2rem;">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
        </button>
        <input type="file" name="profile_picture" accept="image/*" id="profile_pic_input">
      </div>
      <img id="preview" class="preview-img" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
      <small style="color: #6b7280; display: block; margin-top: 0.5rem;">
        (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà / ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏Ñ‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ)
      </small>
    </div>

    <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <div class="form-group">
      <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á = ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
      <input type="text" name="username" 
             placeholder="{{ user.username }}"
             style="width:100%; padding:0.8rem; border:1px solid #d1d5db; border-radius:6px;">
    </div>

    <!-- ‡∏≠‡∏µ‡πÄ‡∏°‡∏• -->
    <div class="form-group">
      <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á = ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
      <input type="email" name="email" 
             placeholder="{{ user.email }}"
             style="width:100%; padding:0.8rem; border:1px solid #d1d5db; border-radius:6px;">
    </div>

    <!-- ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -->
    <div class="form-group">
      <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á = ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
      <input type="tel" name="phone" 
             placeholder="{{ user.phone or '‡πÄ‡∏ä‡πà‡∏ô 0812345678' }}"
             pattern="[0-9]{9,10}"
             style="width:100%; padding:0.8rem; border:1px solid #d1d5db; border-radius:6px;">
    </div>

    <!-- ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô -->
    <div class="form-group">
      <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á = ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
      <input type="password" name="new_password"
             style="width:100%; padding:0.8rem; border:1px solid #d1d5db; border-radius:6px;">
    </div>

    <div style="text-align: center; margin-top: 2rem;">
      <button type="submit" class="btn btn-success" style="padding: 0.9rem 2.5rem; font-size: 1.1rem;">
        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
      </button>
    </div>
  </form>

</div>

<script>
// Preview ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
document.getElementById('profile_pic_input').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      const preview = document.getElementById('preview');
      preview.src = event.target.result;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
});
</script>

{% endblock %}